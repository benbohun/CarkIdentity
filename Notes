$TenantID = "your-tenant-id"  # Replace with your CyberArk Identity tenant ID
$ClientID = "api@cyberark.cloud"  # Replace with CyberArk API Client ID
$ClientSecret = "your-API-password"  # Replace with CyberArk API Client Secret
$TokenURL = "https://$TenantID.id.cyberark.cloud/oauth2/platformtoken"

$Body = @{
    "grant_type"    = "client_credentials"
    "client_id"     = $ClientID
    "client_secret" = $ClientSecret
}

$headers = @{
    "Content-Type" = "application/x-www-form-urlencoded"
}

try {
    $TokenResponse = Invoke-RestMethod -Uri $TokenURL -Method Post -Headers $headers -Body $Body
    Write-Output "Raw Token Response: $TokenResponse"
    Write-Output "Access Token: $($TokenResponse.access_token)"
} catch {
    Write-Output "ERROR: Failed to authenticate - $_"
}
